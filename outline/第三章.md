# 第三章 C 语言程序设计基础

## 第一节 调用函数

### 第一小节 面向过程程序设计核心思路

流程图。

分块（block）（对应函数定义），作用域（scope）（对应变量的作用域和生命周期）。

使用函数进行封装。

### 第二小节 调用函数的语法

**`函数名(参数列表)`**

**参数列表：`参数 1, 参数 2, ...`。**

\*任意多参数。对应的汇编。只有 C 语言有这个特性，C++ 没有，这反映了 C 语言比 C++ 更接近底层的特点。

\*参数的原理就是入栈和出栈，任意多参数的原理：可以进行任意多的入栈和出栈，只要匹配，对外部就没有影响。

一般的函数不会使用任意多参数。

**返回值。计算完后，“括号内的”就变成返回值了。返回值就是函数的“运算”结果。**

**整数的简单输入输出。举几个例子。**

```c
// 1. 输入一个整数。
int a;
//scanf("%d", &a);

//// 2. 输出一个整数。
//printf("%d", a);

// 3. 输入与输出两个整数。
int b;
//scanf("%d%d", &a, &b);
//printf("%d %d", a, b);

// 4. 输出两行整数。
scanf("%d %d", &a, &b);
printf("%d\n%d", a, b);
```

\*`scanf_s`。这是 C 语言标准之外的东西，不要用它。真的要考虑安全，可以用其他函数把所有东西输入进来后，再处理，隔离了外部输入与内部逻辑处理。

仔细读错误列表中的内容。

## 第二节 变量

### 第一小节 变量在存储器中

变量就是存储器中的一片区域。

可以是寄存器，也可以是内存。如果不需要变量的地址（一般只有 C/C++ 需要用到变量的地址），那么这是透明的；如果需要，变量一定对应内存中的一片连续区域。

\*左值与右值（C 语言中这个概念不深刻）。左值就是有地址的“值”，右值反之。

\*更高级的语言的变量可能具有一定结构，特别是“万物皆对象”的语言。C 语言的所有变量都不会存储任何额外信息（额外相对于 C 语言变量的具体类型而言，在下一章（C 语言中的数据与控制）介绍）。

### 第二小节 定义变量

**`类型名 变量名`。**在本小节中只要求掌握类型名为 `int` 的情况，只用理解 `int` 为 32 位有符号整数。

\*标准规定：`int` 是大于等于 16 位的。在目前的个人计算机上，`int` 是 32 位的。

**先定义，后使用。**存在性、空间上。

定义的同时初始化：`类型名 变量名 = 初始值`。

变量的赋值：`变量名 = 值`。

**区分初始化与赋值**：C 语言中，如果编译通过，两者的效果没有区别。但在语法上是不同的东西。例如字符数组的初始化（不要求现在掌握）。

**先初始化，后使用。**特例：把变量的地址告诉另一个函数，该函数帮你为这个变量赋值，注意这并没有用到变量的值。

定义局部变量、全局变量。写在（`main`）函数内和写在函数外。

局部变量：在栈空间中，与栈帧相关联。栈空间的大小是有限的。

全局变量：可以认为总是已被初始化的，默认为 `0`。放在专门放全局变量的地方，大小不限。

### 第三小节 局部变量、静态变量、全局变量

使用调试的方法观察局部变量与全局变量的区别。

虚拟内存再分类。

逻辑上变量的作用域（scope）与生命周期（life span）。

- 局部变量：**从定义开始，到第一个右大括号结束。**生命周期与作用域相同。

- 全局变量：从定义开始，**到该源文件结束。**

  \*多个源文件：从声明开始，到源文件结束。

  生命周期：**整个程序的运行时期。**

*实际上的情况：变量只不过是存储器，只不过是用地址去寻找变量，所以 C 语言帮我们抽象出了一层实际上不存在的逻辑，极大地简化了数据结构的设计。

\*更细致地划分虚拟内存空间。

*静态变量：局部变量的作用域，略小于全局变量的生命周期。

尽量不要使用静态变量和全局变量：副作用。调试那个典型例子。表达式这一节有很多这样的例子。

相关编译错误与警告（使用不同编译器进行展示）。

- 变量未定义。
- 变量先使用，后定义。
- 变量先使用，后初始化。

## 第三节 表达式

### 第一小节 表达式举例

从数学表达式到 C 语言表达式。`1 + 2`。`8 / 5`。（使用一个完整的程序展示）

整数除法。向零取整。

复杂表达式举例。`a + (b / (d * c))`。对应的指令（凸显出实际上是一步一步算的）。

运算符的优先级与结合性。只用知道最基本的（之后还会提到），不清楚只需要打括号，括号的优先级最高。

\*四则运算的表达式树。是一种使用计算机计算表达式的方法。

\*中序遍历。能够看到表达式是转换为一步步的指令的影子。

### 第二小节 表达式的副作用

重新看那个典型例子，以表达式的形式呈现：

```c
int f()
{
	static int ret = 0;
    ret = ret + 1;
    return ret;
}
int main()
{
    int x = 114514;
    int y = f() + x;
    int z = f() + x;
}
```

C 语言中的表达式不是数学中的表达式。始终以执行指令的角度看待 C 语言的表达式。

避免使用有副作用的表达式。表达式最好满足交换律和结合律。

\*由表达式树可以看到，执行顺序是确定的，不能像人计算拉马努金的那个例子的那种思路去思考。

**但如果满足交换律和结合律，就可以用纯数学的角度思考，大大减轻了程序设计难度。**

\*调试时观察有副作用的表达式。（之前已经讲过）

### 第三小节 表达式的计算结果

所有表达式都有最终计算出的值，但类型可能不同。下面举几个例子。

- 调用单个函数也是表达式，计算结果是函数的返回值。特别地，如果函数说自己没有返回值（`void`），返回值就啥也没有，认为是一个类型为 `void` 的值。`void` 类型的值无法参与加减乘除等计算。

  \*但也不是完全不能计算，`void` 类型的值也能成为表达式的一小部分，例如逗号运算符（不要求掌握）。

- 单个变量也是表达式，计算结果就是这个变量。

- 变量赋值（`a = 0`）也是表达式，计算结果也是这个变量。

  ```c
  z = y = x = 1;
  // 等效于
  x = 1;
  y = x;
  z = y;
  ```

\*使用 `scanf` 的返回值。（`scanf` 和 `printf` 要求自学）

## 第四节 顺序结构与分支结构

### 第一小节 自顶向下设计

封装与接口：为了隐藏细节、复用程序，我们需要把程序进行封装，仅留出与外部交互相关的接口（这里的封装与接口不是概念，只是一种思路）。所谓接口，往往就是输入输出。例如：

- 利用 C 语言函数实现封装，以便其他人在不知道函数内部工作原理的情况下使用该函数，则被封装的内容是函数内部具体的执行过程，输入接口是函数的参数列表，输出接口是函数的返回值。
- 利用一个完整的 C 语言控制台程序实现封装，以便其他人（或者在线评测平台）使用（评测）你的程序。输入接口是可以接收键盘输入的控制台窗口，输出接口是可以显示输出内容的控制台窗口。注：在线评测平台对控制台的输入输出进行了重定向，不是在**窗口**上进行输入输出的，而是通过文件或其他方式进行的。
- （更广泛地，封装一个数字电路，以便其他人使用你的数字电路。封装的是内部的电路结构，输入输出接口就是对外开放的引脚。注：对数字电路而言，每一个引脚都只能是逻辑 0 或逻辑 1。）

自顶向下设计。先大致确定要被封装的程序的输入与输出，然后写出整个程序的框架，最后再完善其中功能模块的细节。

“写出整个程序的框架”需要熟悉顺序结构程序设计。

### 第二小节 顺序结构程序设计

计算机工作原理：“之后周而复始地取出指令、分析指令、执行指令”。取出指令的方式：根据 IP 寄存器按顺序依次取出指令。

高级语言中：根据编写语句的顺序，从上到下依次执行。总之，从上到下写就是顺序结构。从当前行的改变情况也能看到。

适用于在线评测平台（少量简单题）的框架：

```c
int main()
{
    input();
    calculate();
    output();
}
```

注：

1. 不一定非要自己定义出三个函数。一般的简单题，完全可以把所有代码写在 `main` 函数中。特别是目前还没有学习如何自己编写函数（主要是没学参数列表，写函数其实大家都会了，程序入口 `main` 函数就是一个函数），更不需要强迫自己写出这样生硬的框架。

2. 这个框架主要是想强调：`calculate` 函数中不要包含任何输入输出相关的语句，在其中你只需要专注计算。而在 `input, output` 函数中只用管输入输出，这样就完全避免了莫名其妙的少输出或多输出。

   例如：P42-44，三整数排序。按最后的框架写，中间步骤不包含任何输出语句，而输出语句十分简单，很难写错，所以查错时只需关注中间的计算过程。

3. 也不一定非要完全遵守这个框架，例如有些问题适合边计算边输出（注意三整数排序不是这样的问题）。

   例如：P48，习题1-6。在判断刚刚完成时就直接输出相应的文字，然后结束程序即可。如果硬要分隔数据处理和输出，就要自己设计一个编码来表示到底是哪个结果（例如用 `0` 表示……，用 `1` 表示……），然后再据此输出文字，绕了一个大弯。

例题：

- **三变量法变量交换。**总是使用这种方法交换变量。

  ```c
  int t = a;
  a = b;
  b = t;
  ```

### 第三小节 分支结构程序设计

程序控制执行：顺序执行 + 跳转（有条件的或无条件的）。

C 语言中的显式跳转：`goto`。不要使用 `goto`，会使得程序难以维护，所以不讲了。

C 语言中使用 `if` 语句实现最简单的分支结构。演示 `if` 语句的跳转（当前行与反汇编）。

- 括号内称为条件，条件会被自动转换为整数，**若整数为 0，则表示假，若整数非 0，则表示真**。

`if-else` 语句。`if` 的右大括号有汇编代码，作用是跳过 `else`。

省略大括号。拿不准时，打上大括号。

`if-else if`：一旦一个条件满足，后面的所有条件了甚至都不会再判断了。

```c
int a = 233;
if (114514 == a)
{
    printf("114514\n");
}
else
{
    if (a == 233)
    {
        printf("233\n");
    }
    else
    {
        if (a == 666)
        {
            printf("666\n");
        }
        else
        {
            printf("不管了\n");
        }
    }
}
```

变量的作用域与 `if` 的大括号。演示离开变量的作用域便无法访问。

例题：

- [Luogu P5712](https://www.luogu.com.cn/problem/P5712)。
- [Luogu P5717](https://www.luogu.com.cn/problem/P5717)。
